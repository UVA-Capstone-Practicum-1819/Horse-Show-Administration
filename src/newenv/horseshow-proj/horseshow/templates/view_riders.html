{% extends 'base.html' %}

{% load crispy_forms_tags %}
{% block content %}
<h2> Riders </h2>

<body>
<div class="container">

  <p> <input class="form-control" id="searchLastName" type="text" placeholder="Search"> <p>

    {% comment %} for adding a new rider, triggers modal popup {% endcomment %}
<p><a class="btn btn-success" data-toggle="modal" data-target="#addRiderModal">
  + Add New Rider</a></p>


  {% comment %} table to hold all the rider records {% endcomment %}
  <table class="table table-hover table-striped table-bordered">
    <thead class="bg-info">
      <th>
        
      </th>
      <th>
        Last Name
      </th>
      <th>
        First Name
      </th>
      <th>
        Email
      </th>
      <th>
        Address
      </th>
      <th>
        City
      </th>
      <th>
        State
      </th>
      <th>
        Zip Code
      </th>
      <th>
        Adult
      </th>
      <th>
        Birth Date
      </th>
      <th>
        Member VHSA
      </th>
      <th>
        Member 4H
      </th>
      <th>
        County
      </th>
      
    </thead>

    <tbody id="riderTable">
      {% for rider in riders %}
        <tr id="rider-row-{{rider.pk}}">
          <td> 
          
          <a href="{% url 'edit_rider' rider_pk=rider.pk %}" class="btn btn-sm btn-warning">Edit</a> 
            <a id="rider-delete-{{rider.pk}}" href="{% url 'delete_rider' rider_pk=rider.pk %}" class="btn btn-sm btn-danger">Remove</a>
          </td>
          <td> {{rider.last_name}} </td>
          <td> {{rider.first_name}} </td>
          <td> {{rider.email}} </td>
          <td> {{rider.address}} </td>
          <td> {{rider.city}} </td>
          <td> {{rider.state}} </td>
          <td> {{rider.zip_code}} </td>
          <td> {{rider.adult}} </td>
          <td> {{rider.birth_date}} </td>
          <td> {{rider.member_VHSA}} </td>
          <td> {{rider.member_4H}} </td>
          <td> {{rider.county}} </td>
          
        </tr>
        
      {% endfor %}
      
    </tbody>
  </table>

  

</div>


<!-- Add Rider Modal Dialog -->
<div class="modal fade" id="addRiderModal" tabindex="-1" role="dialog" aria-labelledby="riderModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="riderModalTitle">Add Rider</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <form id="addRiderForm" class="form" >
        {% csrf_token %}
        <div class="modal-body">
          
          {{ add_rider_form | crispy}}
          <div class="container" id="errorBody"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success" id="addRiderButton">Add Rider</button>
        </div>
      </form>

    </div>
  </div>
</div>
</body>

{% comment %} provides filtering for the rider table {% endcomment %}

 <script>
$(document).ready(function(){
  $("#searchLastName").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#riderTable tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

{% comment %} adds a new rider {% endcomment %}
$(document).ready(function(){
  $("#addRiderButton").click(function(){
    $.post("{% url 'add_rider2' %}",
    $("#addRiderForm").serialize(), function(data, status) {
      if (status="success")
      {
        location.reload();
      }
      else 
        $("#errorBody").load("Message: " + data)
    });
  });
});


// Use validation for the addRiderForm
$( "#addRiderForm" ).submit(function( event ) {
 
    // If .required's value's length is zero
    if ( $( ".required" ).val().length === 0 ) {
 
        // Usually show some kind of error message here
 
        // Prevent the form from submitting
        event.preventDefault();
    } else {
 
        // Run $.ajax() here
    }
});

{% comment %} click to edit rider {% endcomment %}
{% comment %} $(document).ready(function(){
  $("#rider-row-{{rider.pk}}").click(function(){
    $.post("{% url 'add_rider2' %}",
    $("#addRiderForm").serialize(), function() {
      location.reload();
      $("#addRiderForm").reset();
      
      
    });
  });
}); {% endcomment %}

{% comment %} click to delete rider {% endcomment %}

$(document).ready(function(){
  {% for rider in riders %}
    $("#rider-delete-{{rider.pk}}").click(function(){
      $.get("{% url 'delete_rider' rider_pk=rider.pk %}",
      function() {
        location.reload();
    
      });
    });
  {% endfor %}
});



</script> 


{% endblock %}